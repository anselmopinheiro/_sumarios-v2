{% extends "base.html" %}
{% block content %}
<div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4">
  <div>
    <h1 class="h3 mb-1">Anos Letivos</h1>
    <p class="text-muted mb-0">Gestão dos anos letivos, estados e acessos ao calendário escolar.</p>
  </div>
  <div class="mt-3 mt-md-0 d-flex gap-2">
    <a class="btn btn-primary" href="{{ url_for('anos_letivos_add') }}">+ Novo Ano Letivo</a>
    <a class="btn btn-outline-secondary" href="{{ url_for('calendario_escolar') }}">Calendário escolar (ano ativo)</a>
  </div>
</div>

{% if anos %}
<div class="card shadow-sm">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Nome</th>
            <th>Datas</th>
            <th>Semestres</th>
            <th>Estado</th>
            <th class="text-end">Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for a in anos %}
          <tr>
            <td>
              <div class="fw-semibold">{{ a.nome }}</div>
              {% if a.descricao %}
                <div class="text-muted small">{{ a.descricao }}</div>
              {% endif %}
            </td>
            <td class="small text-muted">
              <div><span class="text-dark fw-semibold">Início:</span> {{ a.data_inicio_ano.strftime("%d/%m/%Y") if a.data_inicio_ano }}</div>
              <div><span class="text-dark fw-semibold">Fim:</span> {{ a.data_fim_ano.strftime("%d/%m/%Y") if a.data_fim_ano }}</div>
            </td>
            <td class="small text-muted">
              <div><span class="text-dark fw-semibold">1.º semestre:</span> {{ a.data_fim_semestre1.strftime("%d/%m/%Y") if a.data_fim_semestre1 }}</div>
              <div><span class="text-dark fw-semibold">2.º semestre:</span> {{ a.data_inicio_semestre2.strftime("%d/%m/%Y") if a.data_inicio_semestre2 }}</div>
            </td>
            <td>
              <div class="mb-1">
                {% if a.ativo %}
                  <span class="badge text-bg-success">Ativo</span>
                {% else %}
                  <span class="badge text-bg-secondary">Inativo</span>
                {% endif %}
              </div>
              <div>
                {% if a.fechado %}
                  <span class="badge text-bg-danger">Fechado</span>
                {% else %}
                  <span class="badge text-bg-info text-dark">Aberto</span>
                {% endif %}
              </div>
            </td>
            <td class="text-end">
              <div class="d-flex flex-wrap gap-2 justify-content-end">
                {% if not a.ativo %}
                  <form method="post" action="{{ url_for('anos_letivos_set_ativo', ano_id=a.id) }}" class="d-inline">
                    <button type="submit" class="btn btn-sm btn-outline-primary">Tornar ativo</button>
                  </form>
                {% else %}
                  <span class="badge text-bg-light border">Ano ativo</span>
                {% endif %}

                {% if a.fechado %}
                  <form method="post" action="{{ url_for('anos_letivos_abrir', ano_id=a.id) }}" class="d-inline">
                    <button type="submit" class="btn btn-sm btn-outline-success">Reabrir</button>
                  </form>
                {% else %}
                  <form method="post" action="{{ url_for('anos_letivos_fechar', ano_id=a.id) }}" class="d-inline">
                    <button type="submit" class="btn btn-sm btn-outline-warning">Fechar</button>
                  </form>
                {% endif %}

                <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('anos_letivos_edit', ano_id=a.id) }}">Editar</a>
                <form method="post" action="{{ url_for('anos_letivos_delete', ano_id=a.id) }}" class="d-inline" onsubmit="return confirm('Apagar este ano letivo?');">
                  <button type="submit" class="btn btn-sm btn-outline-danger">Apagar</button>
                </form>
                <a class="btn btn-sm btn-outline-dark" href="{{ url_for('calendario_escolar', ano_id=a.id) }}">Ver calendário</a>
                <a class="btn btn-sm btn-outline-dark" href="{{ url_for('calendario_escolar_gestao', ano_id=a.id) }}">Gerir calendário</a>
                <a class="btn btn-sm btn-outline-dark" href="{{ url_for('calendario_escolar_json', ano_id=a.id) }}">JSON</a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% else %}
  <div class="alert alert-secondary">Sem anos letivos registados.</div>
{% endif %}

{% endblock %}
