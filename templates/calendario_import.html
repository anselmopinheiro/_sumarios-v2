{% extends "base.html" %}
{% block content %}
<div class="d-flex align-items-center mb-3">
  <h3 class="me-3">Importar calendários</h3>
</div>

<div class="card mb-4">
  <div class="card-body">
    <p class="mb-3">
      Importa um backup de calendários em JSON. Podes usar o backup de sumários
      exportado por cada turma ou um ficheiro consolidado com várias turmas. Se
      a turma estiver fechada será ignorada. As turmas são renumeradas após a
      importação.
    </p>
    <form method="post" enctype="multipart/form-data" class="row g-3">
      <div class="col-lg-6">
        <label class="form-label fw-bold">Ficheiro JSON</label>
        <input type="file" name="ficheiro" accept="application/json" class="form-control">
        <div class="form-text">Em alternativa, cola o conteúdo JSON na caixa ao lado.</div>
      </div>
      <div class="col-lg-6">
        <label class="form-label fw-bold">Conteúdo JSON</label>
        <textarea name="conteudo" rows="6" class="form-control js-autoresize" placeholder='{"aulas": [...]}'>{{ request.form.conteudo or '' }}</textarea>
      </div>
      <div class="col-md-6">
        <label class="form-label fw-bold">Aplicar a turma</label>
        <select name="turma_id_padrao" class="form-select">
          <option value="">(usar turma indicada no JSON)</option>
          {% for t in turmas %}
            <option value="{{ t.id }}" {% if request.form.turma_id_padrao|int == t.id %}selected{% endif %}>{{ t.nome }}</option>
          {% endfor %}
        </select>
        <div class="form-text">Usado apenas para linhas sem turma definida no ficheiro.</div>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-success">Importar calendário</button>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <h5 class="card-title">Formato aceite</h5>
    <p class="mb-2">Lista simples de aulas:</p>
    <pre class="bg-light p-3 border">[
  {
    "turma_id": 1,
    "data": "2024-09-10",
    "tipo": "normal",
    "sumarios": "1,2",
    "sumario": "Texto do sumário",
    "previsao": "Planeamento",
    "observacoes": "Notas"
  }
]</pre>
    <p class="mb-2">Ou ficheiro consolidado com várias turmas:</p>
    <pre class="bg-light p-3 border">{
  "turmas": [
    {
      "turma_nome": "10.º A",
      "aulas": [
        {"data": "2024-09-10", "tipo": "normal", "sumarios": "1"},
        {"data": "2024-09-17", "tipo": "greve", "tempos_sem_aula": 2}
      ]
    }
  ]
}</pre>
  </div>
</div>
{% endblock %}
