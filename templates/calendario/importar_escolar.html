{% extends "base.html" %}

{% block content %}
<h2>Importar calendário escolar</h2>

<p class="mb-3">
  Usa um ficheiro JSON exportado (ou compatível) para carregar interrupções letivas e feriados.
  Se não escolheres um ano de destino, é criado um novo ano letivo com as datas do ficheiro.
</p>

<form method="post" enctype="multipart/form-data" action="{{ url_for('calendario_escolar_importar') }}" class="mb-4">
  <div class="mb-3" style="max-width: 420px;">
    <label class="form-label">Ano letivo de destino</label>
    <select name="ano_id" class="form-select">
      <option value="">(criar a partir do ficheiro)</option>
      {% for a in anos %}
        <option value="{{ a.id }}" {% if ano_atual and a.id == ano_atual.id %}selected{% endif %}>{{ a.nome }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3" style="max-width: 520px;">
    <label class="form-label">Ficheiro JSON</label>
    <input type="file" name="ficheiro" accept="application/json" class="form-control">
  </div>

  <div class="mb-3" style="max-width: 760px;">
    <label class="form-label">Ou cola o conteúdo JSON</label>
    <textarea name="conteudo" rows="6" class="form-control js-autoresize"></textarea>
  </div>

  <button type="submit" class="btn btn-primary">Importar</button>
  <a class="btn btn-secondary" href="{{ url_for('calendario_escolar') }}">Voltar ao calendário</a>
</form>

{% if ano_atual %}
  <p>
    Estás no ano letivo atual: <strong>{{ ano_atual.nome }}</strong> — datas entre
    {{ ano_atual.data_inicio_ano.strftime('%d/%m/%Y') if ano_atual.data_inicio_ano else '?' }} e
    {{ ano_atual.data_fim_ano.strftime('%d/%m/%Y') if ano_atual.data_fim_ano else '?' }}.
  </p>
{% endif %}
{% endblock %}
