{% extends "base.html" %}
{% block content %}

<style>
  .simplificado-richtext {
    max-width: 420px;
    word-break: break-word;
  }

  .simplificado-readonly {
    width: 100%;
    min-width: 260px;
    max-width: 420px;
    min-height: 96px;
    font-size: 0.9rem;
    white-space: pre-wrap;
    resize: vertical;
    background: var(--bs-body-bg);
  }
</style>

<h2>Calendário simplificado — Turma {{ turma.nome }}</h2>

{% if ano %}
  <p class="text-muted">
    Ano letivo: {{ ano.nome }}
    {% if ano_fechado %}
      <span class="badge bg-danger">Fechado (só leitura)</span>
    {% endif %}
  </p>
{% endif %}

<form method="get" class="row g-3 mb-3">
  <div class="col-md-4">
    <label class="form-label">Período</label>
    <select name="periodo_id" class="form-select" onchange="this.form.submit()">
      {% for p in periodos_disponiveis %}
        <option value="{{ p.id }}"
          {% if periodo_atual and p.id == periodo_atual.id %}selected{% endif %}>
          {{ p.nome }} ({{ p.data_inicio.strftime("%d/%m/%Y") }} – {{ p.data_fim.strftime("%d/%m/%Y") }})
        </option>
      {% endfor %}
    </select>
  </div>
</form>

<div class="mb-3">
  <a href="{{ url_for('turma_calendario', turma_id=turma.id, periodo_id=periodo_atual.id if periodo_atual else None) }}" class="btn btn-secondary">
    ← Voltar ao calendário completo
  </a>
  <a href="{{ url_for('turma_calendario_dia', turma_id=turma.id, periodo_id=periodo_atual.id if periodo_atual else None) }}" class="btn btn-outline-secondary ms-1">
    Ver por dia
  </a>
</div>

{% if aulas %}
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th>Turma</th>
          <th>Data</th>
          <th>N.º Sumário</th>
          <th>Módulo</th>
          <th>Aula do módulo</th>
          <th>Sumário</th>
          <th>Previsão</th>
        </tr>
      </thead>
      <tbody>
        {% for a in aulas %}
          <tr>
            <td class="fw-semibold">{{ turma.nome }}</td>
            <td>{{ a.data.strftime('%d/%m/%Y') if a.data else '—' }}</td>
            <td>
              <a href="{{ url_for('turma_calendario_dia', turma_id=turma.id, data=a.data.isoformat() if a.data else None, periodo_id=periodo_atual.id if periodo_atual else None) }}">
                {{ a.sumarios or '—' }}
              </a>
            </td>
            <td>{% if a.modulo %}{{ a.modulo.nome }}{% else %}Sem módulo{% endif %}</td>
            <td>{{ a.numero_modulo or '—' }}</td>
            <td>
              {% if a.sumario %}
                <textarea class="form-control form-control-sm simplificado-readonly" readonly>{{ a.sumario|e }}</textarea>
              {% else %}
                —
              {% endif %}
            </td>
            <td>
              {% if a.previsao %}
                <textarea class="form-control form-control-sm simplificado-readonly" readonly>{{ a.previsao|e }}</textarea>
              {% else %}
                —
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-secondary">Ainda não existem aulas para o período selecionado.</div>
{% endif %}

{% endblock %}
