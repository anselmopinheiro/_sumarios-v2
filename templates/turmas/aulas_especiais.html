{% extends "base.html" %}
{% block content %}

<h2>Aulas especiais</h2>
<p class="text-muted">Visualização de greves, serviço oficial, faltei, outros e extras em todas as turmas.</p>

<form method="get" class="row g-3 align-items-end mb-4">
  <div class="col-12 col-md-3">
    <label class="form-label">Data início</label>
    <input type="date" name="data_inicio" class="form-control" value="{{ data_inicio.isoformat() if data_inicio else '' }}">
  </div>
  <div class="col-12 col-md-3">
    <label class="form-label">Data fim</label>
    <input type="date" name="data_fim" class="form-control" value="{{ data_fim.isoformat() if data_fim else '' }}">
  </div>
  <div class="col-12 col-md-3">
    <label class="form-label">Turma</label>
    <select name="turma_id" class="form-select">
      <option value="">Todas</option>
      {% for t in turmas %}
        <option value="{{ t.id }}" {% if filtro_turma_id and filtro_turma_id == t.id %}selected{% endif %}>{{ t.nome }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-12 col-md-2">
    <label class="form-label">Tipo</label>
    <select name="tipo" class="form-select">
      <option value="">Todos</option>
      {% for valor, label in tipos_aula %}
        {% if valor in tipos_especiais %}
          <option value="{{ valor }}" {% if filtro_tipo == valor %}selected{% endif %}>{{ label }}</option>
        {% endif %}
      {% endfor %}
    </select>
  </div>
  <div class="col-12 col-md-1 d-grid">
    <button type="submit" class="btn btn-primary">Filtrar</button>
  </div>
</form>

{% if aulas %}
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Turma</th>
          <th>Data</th>
          <th>Tipo</th>
          <th>Módulo</th>
          <th>N.º Sumário(s)</th>
          <th>Aula / Total</th>
          <th style="width: 35%;">Sumário</th>
        </tr>
      </thead>
      <tbody>
        {% for a in aulas %}
          {% set sem_aula = a.tipo in tipos_sem_aula %}
          <tr>
            <td class="fw-semibold">{{ a.turma.nome if a.turma else '—' }}</td>
            <td class="text-nowrap">
              {% if a.data %}
                {{ a.data.strftime("%d/%m/%Y") }}<br>
                <small class="text-muted">{{ ["Seg", "Ter", "Qua", "Qui", "Sex", "Sáb", "Dom"][a.data.weekday()] }}</small>
              {% endif %}
            </td>
            <td>
              <span class="badge bg-secondary text-light">{{ tipo_labels.get(a.tipo, a.tipo) }}</span>
            </td>
            <td>{{ a.modulo.nome if a.modulo else '—' }}</td>
            <td>{% if sem_aula %}—{% else %}{{ a.sumarios or '' }}{% endif %}</td>
            <td>
              <div>Aula {% if sem_aula %}—{% else %}{{ a.numero_modulo or '' }}{% endif %}</div>
              <div class="text-muted">Total {% if sem_aula %}—{% else %}{{ a.total_geral or '' }}{% endif %}</div>
            </td>
            <td>{{ a.sumario or '' }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-info">Não foram encontradas aulas com os tipos selecionados.</div>
{% endif %}

{% endblock %}
